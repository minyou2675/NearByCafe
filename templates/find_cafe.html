{% extends 'nav.html' %} {% block content %} {% load static %}

<div class="container1 d-flex">
    <div class="left_container">
        <div class="location_container d-flex flex-column">
            <div class="location_text fw-bold">지역 설정</div>
            <!-- <button class="search" onclick="onClickSearch('{{location}}')">검색하기</button> -->

            <!-- <button class="selected_location" onClick="onClickLocationButton()" >
                <input class="selected_location_cat" 
                type="text" 
                name="location" 
                readonly onfocus="this.blur();" 
                placeholder="선택한 지역 띄우기!" 
                /> 
            </button> -->

            <div class="d-flex flex-row align-items-center">
                <div class="selected_location location_input d-flex align-items-center" onclick="onClickLocationButton()">
                    <!-- <p>지역 선택</p> -->
                    <button class="location_picked" onclick="onClickLocationText()">
                        <span class="location_picked_text">{{loc}}</span>
                    </button>
                </div>
            </div>

            <div class="dropdown_location_list display_none">
                <div class="location_list d-flex flex-column shadow">
                    <div class="loc-text1">검색할 위치를 선택해주세요.</div>

                    <div class="d-flex flex-row">
                        <div class="d-flex flex-column">
                            {% for location in location_list_left %}
                            <div class="loc1 d-flex flex-row align-center">
                                <button class="loc_btn">
                                    <span class="loc_list" onclick="onClickLocationList()">{{location}}</span>
                                </button>
                            </div>
                            {% endfor %}
                        </div>
                        <div class="d-flex flex-column">
                            {% for location in location_list_right %}
                            <div class="loc1 d-flex flex-row align-center">
                                <button class="loc_btn">
                                    <span class="loc_list" onclick="onClickLocationList()">{{location}}</span>
                                </button>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="find_keyword_container">
            <div class="keyword_text1 fw-bold">키워드 설정</div>
            <div class="keyword_box keyword_box_container d-flex flex-row justify-content-space-between">
                <div class="d-flex flex-column">
                    <div class="cat1 d-flex flex-row align-center">
                        <input class="checkbox" type="checkbox" name="date" value="데이트" /> <span class="checkbox_list date_text">데이트</span>
                    </div>
                    <div class="cat1 d-flex flex-row align-center">
                        <input class="checkbox" type="checkbox" name="quiet" value="조용한" /> <span class="checkbox_list">조용한</span>
                    </div>
                    <div class="cat1 d-flex flex-row align-center">
                        <input class="checkbox" type="checkbox" name="dessert" value="디저트가 맛있는" /> <span class="checkbox_list">디저트가 맛있는</span>
                    </div>
                    <div class="cat1 d-flex flex-row align-center">
                        <input class="checkbox" type="checkbox" name="kind" value="친절한" /> <span class="checkbox_list">친절한</span>
                    </div>
                    <div class="cat1 d-flex flex-row align-center">
                        <input class="checkbox" type="checkbox" name="concent" value="콘센트가 많은" /> <span class="checkbox_list">콘센트가 많은</span>
                    </div>
                </div>

                <div class="d-flex flex-column">
                    <div class="cat2 d-flex flex-row align-center">
                        <input class="checkbox" type="checkbox" name="work" value="작업하기 좋은" /> <span class="checkbox_list">작업하기 좋은</span>
                    </div>
                    <div class="cat2 d-flex flex-row align-center">
                        <input class="checkbox" type="checkbox" name="loud" value="시끌벅적한" /> <span class="checkbox_list">시끌벅적한</span>
                    </div>
                    <div class="cat2 d-flex flex-row align-center">
                        <input class="checkbox" type="checkbox" name="coffee" value="커피가 맛있는" /> <span class="checkbox_list">커피가 맛있는</span>
                    </div>
                    <div class="cat2 d-flex flex-row align-center">
                        <input class="checkbox" type="checkbox" name="alone_cafe" value="혼카페" /> <span class="checkbox_list">혼카페</span>
                    </div>
                    <div class="cat2 d-flex flex-row align-center">
                        <input class="checkbox" type="checkbox" name="bathroom" value="화장실 깨끗한" /> <span class="checkbox_list">화장실 깨끗한</span>
                    </div>
                </div>

                <div class="d-flex flex-column">
                    <div class="cat3 d-flex flex-row align-center">
                        <input class="checkbox" type="checkbox" name="study" value="공부하기 좋은" /> <span class="checkbox_list">공부하기 좋은</span>
                    </div>
                    <div class="cat3 d-flex flex-row align-center">
                        <input class="checkbox" type="checkbox" name="seat" value="의자가 편한" /> <span class="checkbox_list">의자가 편한</span>
                    </div>
                    <div class="cat3 d-flex flex-row align-center">
                        <input class="checkbox" type="checkbox" name="cheap" value="저렴한" /> <span class="checkbox_list">저렴한</span>
                    </div>
                    <div class="cat3 d-flex flex-row align-center">
                        <input class="checkbox" type="checkbox" name="big" value="장소가 넓은" /> <span class="checkbox_list">장소가 넓은</span>
                    </div>
                    <div class="cat3 d-flex flex-row align-center">
                        <input class="checkbox" type="checkbox" name="interior" value="인테리어 예쁜" /> <span class="checkbox_list">인테리어 예쁜</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="cafe_list_container">
            <div class="sort_container">
                <!-- <form action="" method="POST"> -->
                {% csrf_token %}
                <input type="hidden" name="cafe_location_name" id="cafe_location_name" value="" />
                <input type="hidden" name="cafe_keyword_name" id="cafe_keyword_name" value="" />
                <button class="search" type="button" onclick="onClickSearch()"><span class="btn_text3">카페 검색하기</span></button>
                <!-- </form> -->
                <div class="sort">
                    <button class="sort_abc"><span class="btn_text2">가나다 순</span></button>
                    <button class="sort_star active"><span class="btn_text2">평점 순</span></button>
                </div>
                <p class="sort_text3">총 <span class="num__of__cafe" style="color: #df4629">갯수 넣기</span>개의 카페가 검색되었습니다.</p>
            </div>

            <!-- {% for cafe in cafe_list %} 
                cafe.image
                cafe.name
                cafe.address
                cafe.image 
            {% endfor %} -->

            <div class="cafe_list">
                <!-- <div class="cafe d-flex">
                    <img src="" alt="" class="cafe_img">
                    <div class="cafe_info d-flex flex-column">
                        <span class="cafe_name">카페 상호명</span>                    
                        <span class="cafe_loc">서울시 마포구 와우산로 94</span>         
                        <span class="cafe_categ">#공부하기 좋은 #분위기 예쁜 #저렴한</span> 
                        <div class="cafe_star_info">             
                            <span style="color: #F8AA14">3.0</span>                     
                            <span>⭐️⭐️⭐️⭐️⭐️</span>                
                            <span style="color: #AAAAAA">(65)</span>                    
                        </div>
                    </div>
                </div>

                <div class="cafe d-flex">
                    <img src="" alt="" class="cafe_img">
                    <div class="cafe_info d-flex flex-column">
                        <span class="cafe_name">카페 상호명</span>                    
                        <span class="cafe_loc">서울시 마포구 와우산로 94</span>         
                        <span class="cafe_categ">#공부하기 좋은 #분위기 예쁜 #저렴한</span> 
                        <div class="cafe_star_info">             
                            <span style="color: #F8AA14">3.0</span>                     
                            <span>⭐️⭐️⭐️⭐️⭐️</span>                
                            <span style="color: #AAAAAA">(65)</span>                    
                        </div>
                    </div>
                </div>

                <div class="cafe d-flex">
                    <img src="" alt="" class="cafe_img">
                    <div class="cafe_info d-flex flex-column">
                        <span class="cafe_name">카페 상호명</span>                    
                        <span class="cafe_loc">서울시 마포구 와우산로 94</span>         
                        <span class="cafe_categ">#공부하기 좋은 #분위기 예쁜 #저렴한</span> 
                        <div class="cafe_star_info">             
                            <span style="color: #F8AA14">3.0</span>                     
                            <span>⭐️⭐️⭐️⭐️⭐️</span>                
                            <span style="color: #AAAAAA">(65)</span>                    
                        </div>
                    </div>
                </div>

                <div class="cafe d-flex">
                    <img src="" alt="" class="cafe_img">
                    <div class="cafe_info d-flex flex-column">
                        <span class="cafe_name">카페 상호명</span>                    
                        <span class="cafe_loc">서울시 마포구 와우산로 94</span>         
                        <span class="cafe_categ">#공부하기 좋은 #분위기 예쁜 #저렴한</span> 
                        <div class="cafe_star_info">             
                            <span style="color: #F8AA14">3.0</span>                     
                            <span>⭐️⭐️⭐️⭐️⭐️</span>                
                            <span style="color: #AAAAAA">(65)</span>                    
                        </div>
                    </div>
                </div>-->
            </div>
        </div>
        <!-- <div class="d-flex justify-content-center">
            <button class="more_btn"><span class="more_text">더보기</span></button>
        </div> -->
    </div>

    <div id="map"></div>
</div>

<!-- <script src="/static/js/keyword.js"></script> -->
<!-- <script src="/static/js/find_cafe.js"></script> -->

<script>
    var container = document.getElementById("map");
    var latitude = "{{latitude}}";
    var longtitude = "{{longtitude}}";
    var options = {
        // center: new kakao.maps.LatLng( 37.61065041034093,126.99985276595638 ),
        center: new kakao.maps.LatLng(latitude, longtitude),
        level: 3,
    };

    var map = new kakao.maps.Map(container, options);

    // 지역 마커, 카페 마커들을 담는 리스트 (전역 변수)
    var marker = null;
    var cafe_markers = [];

    const panTo = (latitude, longtitude) => {
        var moveLatLon = new kakao.maps.LatLng(latitude, longtitude);
        var markerPosition = new kakao.maps.LatLng(latitude, longtitude);

        if (marker) {
            marker.setMap(null);
        }

        marker = new kakao.maps.Marker({
            position: markerPosition,
        });

        marker.setMap(map);
        map.panTo(moveLatLon);
    };

    //find_cafe 페이지로 이동할 시 이전 메인페이지에 있던 값들 넘겨주면서 지도 이동 + 카페 리스트 띄움
    const Search = async () => {
        //키워드 선택//

        const location = "{{loc}}";
        var keyword = "{{keyword}}";
        if (keyword.length !== 0) {
            keyword = JSON.parse(keyword.replace(/&quot;/g, '"'));
        }

        console.log("지역", location, "키워드", keyword);

        const res = await fetch("/find_cafe_ajax/", {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded",
            },
            body: JSON.stringify({ location: location, checked_keywords: keyword }),
        });

        // const res = await fetch('/cafe/find_cafe')
        // .then(console.log(Response))
        // .catch(console.log(console.error()))

        //받는거
        const { latitude: latitude, longtitude: longtitude, cafes: cafes } = await res.json();
        console.log(latitude, longtitude, cafes);
        // 만약 지역이 서울 전체면
        if (location == "서울 전체") {
            map.setLevel(7);
        } else {
            map.setLevel(3);
        }

        cafeHandleResponse(cafes);
        panTo(latitude, longtitude);
        cafeMarker(cafes);
    };

    const cafeMarker = (cafes) => {
        let cafeNameArr = [];
        let cafeLatArr = [];
        let cafeLngArr = [];

        var imageSrc = "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png";
        cafes.forEach((item) => {
            cafeNameArr.push(item.name);
            cafeLatArr.push(item.latitude);
            cafeLngArr.push(item.longtitude);
        });

        var positions = [];
        for (var i = 0; i < cafes.length; i++) {
            positions.push({
                title: cafeNameArr[i],
                latlng: new kakao.maps.LatLng(cafeLatArr[i], cafeLngArr[i]),
            });
        }

        if (cafe_markers) {
            for (var i = 0; i < cafe_markers.length; i++) {
                cafe_markers[i].setMap(null);
            }
        }

        for (var i = 0; i < cafes.length; i++) {
            var imageSize = new kakao.maps.Size(24, 35);
            var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize);
            var marker = new kakao.maps.Marker({
                map: map, // 마커를 표시할 지도
                position: positions[i].latlng, // 마커를 표시할 위치
                title: positions[i].title, // 마커의 타이틀, 마커에 마우스를 올리면 타이틀이 표시됩니다
                image: markerImage, // 마커 이미지
            });
            cafe_markers.push(marker);
        }
    };
</script>
<script>
    const MAX_CHECKBOXES = 3;
    var checkboxes = document.querySelectorAll(".checkbox");
    var checkedCheckboxes = [];
    var checked = [];
    const locationInput = document.querySelector("#cafe_location_name");

    const main__keywords = "{{keyword}}";
    console.log(main__keywords.length);

    if (main__keywords.length !== 0) {
        const selectedValues = JSON.parse(main__keywords.replace(/&quot;/g, '"'));
        console.log(selectedValues);

        // 메인에서 넘어온 값들 체크
        checkboxes.forEach(function (checkbox) {
            if (selectedValues.includes(checkbox.value)) {
                checkbox.checked = true;
                checkedCheckboxes.push(checkbox.value);
                checked.push(checkbox);
            }
        });
    }

    // 모든 체크박스마다 이벤트 리스너 추가
    checkboxes.forEach(function (checkbox) {
        checkbox.addEventListener("change", function () {
            if (this.checked) {
                checkedCheckboxes.push(this.value); // 체크된 리스트에 추가
                checked.push(this);
                if (checkedCheckboxes.length > MAX_CHECKBOXES) {
                    var oldestCheckbox = checkedCheckboxes.shift();
                    var oldestCheck = checked.shift();
                    oldestCheck.checked = false;
                }
            } else {
                checkedCheckboxes.splice(checkedCheckboxes.indexOf(this), 1);
            }
        });
    });
    console.log(checkedCheckboxes);
    const dropdown_menu = document.querySelector(".dropdown_location_list");
    const location_drop = document.querySelector(".location_drop");

    var clicked_state = 0;
    function onClickLocationButton() {
        if (clicked_state === 1) {
            dropdown_menu.classList.add("display_none");
            clicked_state = 0;
        } else {
            dropdown_menu.classList.remove("display_none");
            clicked_state = 1;
        }
    }

    function onClickLocationText() {
        if (clicked_state === 1) {
            dropdown_menu.classList.add("display_none");
            clicked_state = 0;
        } else {
            dropdown_menu.classList.remove("display_none");
            clicked_state = 1;
        }
    }

    // 위치 넘어왔을 때 다시 선택하고 검색할 필요 없게 만들기
    var form_keyword_input = document.querySelector('input[name="cafe_keyword_name"]');

    var main_location = document.querySelector(".location_picked_text");
    var main_location_text = main_location.innerText;
    locationInput.value = "{{loc}}";

    function onClickLocationList() {
        var location_picked = event.target;
        var location_each = location_picked.innerText;

        // const location_input = document.querySelector(".location_input");
        // let location_placeholder = location_input.placeholder;
        // location_placeholder = "";

        const location_picked_text = document.querySelector(".location_input");
        location_picked_text.innerHTML = `<button class="location_picked" onclick="${onClickLocationText()}">
            <span class="location_picked_text">${location_each}</span>
            </button>`;

        locationInput.value = location_each;
        console.log(locationInput);
    }

    var clickedKeywordList = [];
    function onClickKeyword() {
        var keyword_picked = event.target;
        var keyword_each = keyword_picked.value;
        clickedKeywordList.push(keyword_each);
        console.log(clickedKeywordList);
        form_keyword_input.value = JSON.stringify(clickedKeywordList);
    }

    console.log(checkedCheckboxes);

    const onClickSearch = async () => {
        //키워드 선택//
        console.log(checkedCheckboxes);
        checked_keywords = checkedCheckboxes;
        const location = locationInput.value;
        console.log(typeof checked_keywords);
        console.log("지역", location, "키워드", checked_keywords);

        const res = await fetch("/find_cafe_ajax/", {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded",
            },
            body: JSON.stringify({ location: location, checked_keywords: checked_keywords }),
        });

        // const res = await fetch('/cafe/find_cafe')
        // .then(console.log(Response))
        // .catch(console.log(console.error()))

        //받는거
        const { latitude: latitude, longtitude: longtitude, cafes: cafes } = await res.json();

        // 만약 지역이 서울 전체면
        if (location == "서울 전체") {
            map.setLevel(7);
        } else {
            map.setLevel(3);
        }

        console.log(latitude, longtitude, cafes);
        cafeHandleResponse(cafes);
        panTo(latitude, longtitude);
        cafeMarker(cafes);
    };

    const cafeHandleResponse = (cafes) => {
        var element = document.querySelector(".cafe_list");
        
        element.innerHTML = "";
        // element.innerHTML = `<div class="cafe_list">`;
        cafes.forEach((item) => {
            let star = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill" viewBox="0 0 16 16">
                            <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                          </svg><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill" viewBox="0 0 16 16">
                            <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                          </svg><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill" viewBox="0 0 16 16">
                            <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                          </svg><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill" viewBox="0 0 16 16">
                            <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                          </svg><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill" viewBox="0 0 16 16">
                            <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                          </svg>`;
            if (item.average_star <= 0) {
                star = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star" viewBox="0 0 16 16">
                            <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288L8 2.223l1.847 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.565.565 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                          </svg><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star" viewBox="0 0 16 16">
                            <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288L8 2.223l1.847 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.565.565 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                          </svg><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star" viewBox="0 0 16 16">
                            <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288L8 2.223l1.847 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.565.565 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                          </svg><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star" viewBox="0 0 16 16">
                            <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288L8 2.223l1.847 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.565.565 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                          </svg><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star" viewBox="0 0 16 16">
                            <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288L8 2.223l1.847 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.565.565 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                          </svg>`
            }
            else if (1 <= item.average_star && item.average_star < 2) {
                star = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill" viewBox="0 0 16 16">
                            <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                          </svg><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star" viewBox="0 0 16 16">
                            <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288L8 2.223l1.847 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.565.565 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                          </svg><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star" viewBox="0 0 16 16">
                            <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288L8 2.223l1.847 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.565.565 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                          </svg><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star" viewBox="0 0 16 16">
                            <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288L8 2.223l1.847 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.565.565 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                          </svg><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star" viewBox="0 0 16 16">
                            <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288L8 2.223l1.847 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.565.565 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                          </svg>`;
            } else if (2 <= item.average_star && item.average_star < 3) {
                star = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill" viewBox="0 0 16 16">
                            <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                          </svg><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill" viewBox="0 0 16 16">
                            <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                          </svg><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star" viewBox="0 0 16 16">
                            <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288L8 2.223l1.847 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.565.565 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                          </svg><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star" viewBox="0 0 16 16">
                            <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288L8 2.223l1.847 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.565.565 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                          </svg><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star" viewBox="0 0 16 16">
                            <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288L8 2.223l1.847 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.565.565 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                          </svg>`;
            } else if (3 <= item.average_star && item.average_star < 4) {
                star = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill" viewBox="0 0 16 16">
                            <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                          </svg><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill" viewBox="0 0 16 16">
                            <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                          </svg><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill" viewBox="0 0 16 16">
                            <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                          </svg><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star" viewBox="0 0 16 16">
                            <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288L8 2.223l1.847 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.565.565 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                          </svg><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star" viewBox="0 0 16 16">
                            <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288L8 2.223l1.847 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.565.565 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                          </svg>`;
            } else if (4 <= item.average_star && item.average_star < 5) {
                star = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill" viewBox="0 0 16 16">
                            <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                          </svg><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill" viewBox="0 0 16 16">
                            <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                          </svg><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill" viewBox="0 0 16 16">
                            <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                          </svg><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill" viewBox="0 0 16 16">
                            <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                          </svg><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star" viewBox="0 0 16 16">
                            <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288L8 2.223l1.847 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.565.565 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                          </svg>`;
            } else if (5 <= item.average_star) {
                star = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill" viewBox="0 0 16 16">
                            <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                          </svg><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill" viewBox="0 0 16 16">
                            <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                          </svg><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill" viewBox="0 0 16 16">
                            <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                          </svg><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill" viewBox="0 0 16 16">
                            <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                          </svg><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill" viewBox="0 0 16 16">
                            <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                          </svg>`;
            }

            element.innerHTML += `
        <div class="cafe d-flex">
            <img src="/media/${item.image}" alt="이미지가 없습니다" class="cafe_img">
        <div class="d-flex flex-column">
        <a href='cafe_detail/${item.id}'  class="find_cafe_name">${item.name}</a>
        <span class="cafe_loc">${item.address}</span>
        <span class="cafe_categ">#${JSON.parse(item.keywords).join(" #")}</span>
        <div class="cafe_star_info d-flex align-items-center">
            <span style="color: #F8AA14">${item.average_star}점</span>
            <span style="color: #F9B717; font-size: 18px; font-weight: bold; padding-bottom: 5px; margin: 0 5px 0 5px;" >${star}</span>
            <span style="color: #AAAAAA">(${item.review_cnt})</span>
        </div>
        </div>
    </div>`;
        });
        console.log(cafes.length);
        var numofcafes = document.querySelector(".num__of__cafe");
        numofcafes.innerHTML = cafes.length;
    };

    // Get the sort buttons
    const sortAbcButton = document.querySelector(".sort_abc");
    const sortStarButton = document.querySelector(".sort_star");

    sortAbcButton.addEventListener("click", () => {
        sortAbcButton.classList.add("active");
        sortStarButton.classList.remove("active");
    });

    sortStarButton.addEventListener("click", () => {
        sortStarButton.classList.add("active");
        sortAbcButton.classList.remove("active");
    });

    // Get the container that holds the cafe items
    const cafeContainer = document.querySelector(".cafe_list");

    // Sort the cafe items by name
    function sortByName() {
        const items = Array.from(cafeContainer.children);
        items.sort((a, b) => {
            const aName = a.querySelector(".find_cafe_name").textContent;
            const bName = b.querySelector(".find_cafe_name").textContent;
            return aName.localeCompare(bName);
        });
        items.forEach((item) => cafeContainer.appendChild(item));
    }

    // Sort the cafe items by average star rating
    function sortByStar() {
        const items = Array.from(cafeContainer.children);
        items.sort((a, b) => {
            const aStar = parseFloat(a.querySelector(".cafe_star_info span:first-child").textContent);
            const bStar = parseFloat(b.querySelector(".cafe_star_info span:first-child").textContent);
            return bStar - aStar;
        });
        items.forEach((item) => cafeContainer.appendChild(item));
    }

    // Add event listeners to the sort buttons
    sortAbcButton.addEventListener("click", sortByName);
    sortStarButton.addEventListener("click", sortByStar);

    Search();
</script>

<script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
    crossorigin="anonymous"
></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- <script src="static/find_cafe.js" -->
{% endblock %}
